(function(c){var k={init:function(a){return this.each(function(){function k(){q&&clearTimeout(q);q=setTimeout(u,b.keyDelay)}function u(){var d=c.trim(e.val()).replace(/[\\]+|[\/]+/g,"").replace(/\s+/g," ");j=d;if(d.length>=b.minChars){b.beforeRetrieve&&(d=b.beforeRetrieve.call(this,d));e.addClass("loading");b.loadingText&&i.html('<li class="ds-message">'+b.loadingText+"</li>").show();f.show();if(b.remoteSource){n&&n.abort();var g={};g[b.queryParam]=d;n=c.getJSON(b.remoteSource,c.extend({},g,b.extraParams),
function(b){r(b,d,!1)})}b.localSource&&r(b.localSource,d,!0)}else f.hide()}function s(d){if(0<c("li.ds-result-item:visible",f).length){var g=c("li",f),a="down"===d?g.eq(0):g.filter(":last"),i=c("li.active:first",f);0<i.length&&(a="down"===d?i.next():i.prev());g.removeClass("active");a.addClass("active");0<a.length&&b.onResultFocus.call(e,a.data());d=0<a.length?a.data()[b.selectValue]:j;e.val(d)}}function r(d,g,a){var d=b.retrieveComplete.call(this,d,g,a),k=b.seekValue.split(","),j=0,l=0;if(a||!b.localSource)i.html(""),
f.hide();for(var n in d)if(d.hasOwnProperty(n)){for(var m="",h=0;h<k.length;h++)m+=void 0!==d[l][c.trim(k[h])]?d[l][c.trim(k[h])]:"";b.matchCase||(m=m.toLowerCase(),g=g.toLowerCase());var h=g.split(" "),o=!1,p;for(p in h)h.hasOwnProperty(p)&&-1!==m.search(h[p])&&(o=!0);if(!0===o){d[l]._dataSource=a?"local":"remote";d[l]._number=j;m=c('<li class="ds-result-item" id="ds-result-item-'+l+'"></li>').data(d[l]);o=c.extend({},d[l]);if(b.resultsHighlight)for(p in h)h.hasOwnProperty(p)&&(o[b.selectValue]=
o[b.selectValue].replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+h[p]+")(?![^<>]*>)(?![^&;]+;)",""+(!b.matchCase?"gi":"g")+""),"<em>$1</em>"));h=b.formatList?b.formatList.call(e,o,m):m.html(o[b.selectValue]);i.append(h);j++;if(b.queryLimit&&b.queryLimit===j)break}l++}e.removeClass("loading");0>=j&&b.emptyText&&i.html('<li class="ds-message">'+b.emptyText+"</li>");f.show();b.resultsComplete.call(this)}var b=c.extend({},c.fn.doubleSuggest.defaultOptions,a),e=c(this).addClass("ds-input"),t=e.attr("id"),v=c('<div class="ds-container" id="ds-container-'+
t+'"></div>');e.wrap(v);var f=c('<div class="ds-results" id="ds-results-'+t+'"></div>').hide();e.after(f);var i=c('<ul class="ds-list"></ul>').css("width",e.outerWidth()).appendTo(f),j="",q=null,n=null;e.on({"focus.doubleSuggest":function(){""!==c.trim(e.val())&&f.show()},"keydown.doubleSuggest":function(d){var a=d.keyCode;switch(a){case 38:case 40:d.preventDefault();38===a?s("up"):s("down");break;case 8:1===e.val().length&&f.hide();k();break;case 9:case 13:a=c.trim(e.val());""!==a&&a.length>=b.minChars&&
0<c("li.ds-result-item:visible",f).length&&0<c("li.active:first",i).length&&(c("li.active:first",i).trigger("select"),d.preventDefault());break;case 27:n&&n.abort();f.hide();break;default:46===a||9<a&&32>a?f.hide():k()}},"blur.doubleSuggest":function(){f.is(":hover")||(e.val(j),f.hide())},"updateOptions.doubleSuggest":function(d,e){b=c.extend(c.fn.doubleSuggest.defaultOptions,a,e)},"destroy.doubleSuggest":function(){f.remove();e.val("").removeClass("ds-input").unbind(".doubleSuggest").unwrap()}});
f.on({click:function(){c(this).trigger("select")},mouseover:function(){c("li",i).removeClass("active");c(this).addClass("active");b.onResultFocus.call(e,c(this).data())},select:function(){var a=c(this),g=a.data();j=g[b.selectValue];e.val(j);b.onSelect.call(e,g,a);i.html("");f.hide()}},".ds-result-item")})},update:function(a){return this.each(function(){c(this).trigger("updateOptions",a)})},destroy:function(){return this.each(function(){c(this).trigger("destroy")})}};c.fn.doubleSuggest=function(a){if(k[a])return k[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return k.init.apply(this,arguments);c.error("Invalid arguments "+a+" on jQuery.doubleSuggest")};c.fn.doubleSuggest.defaultOptions={localSource:!1,remoteSource:!1,emptyText:!1,loadingText:"Loading...",newItem:!1,selectValue:"name",seekValue:"name",queryParam:"q",queryLimit:!1,extraParams:{},matchCase:!1,minChars:1,keyDelay:500,resultsHighlight:!0,onSelect:function(){},onResultFocus:function(){},formatList:!1,beforeRetrieve:function(a){return a},
retrieveComplete:function(a){return a},resultsComplete:function(){}}})(jQuery);